'use strict';

var h = require('fs');
var v = require('path');
var url = require('url');

function _interopDefault (e) { return e && e.__esModule ? e : { default: e }; }

var h__default = /*#__PURE__*/_interopDefault(h);
var v__default = /*#__PURE__*/_interopDefault(v);

var s={".m":"margin:$px",".ml":"margin-left:$px",".mr":"margin-right:$px",".mt":"margin-top:$px",".mb":"margin-bottom:$px",".mx":"margin-left:$px;margin-right:$px",".my":"margin-top:$px;margin-bottom:$px",".mi":"margin:$px !important",".mli":"margin-left:$px !important",".mri":"margin-right:$px !important",".mti":"margin-top:$px !important",".mbi":"margin-bottom:$px !important",".mxi":"margin-left:$px !important;margin-right:$px !important",".myi":"margin-top:$px !important;margin-bottom:$px !important",".p":"padding:$px",".pl":"padding-left:$px",".pr":"padding-right:$px",".pt":"padding-top:$px",".pb":"padding-bottom:$px",".px":"padding-left:$px;padding-right:$px",".py":"padding-top:$px;padding-bottom:$px",".pi":"padding:$px !important",".pli":"padding-left:$px !important",".pri":"padding-right:$px !important",".pti":"padding-top:$px !important",".pbi":"padding-bottom:$px !important",".pxi":"padding-left:$px !important;padding-right:$px !important",".pyi":"padding-top:$px !important;padding-bottom:$px !important",".w":"width:$px",".wi":"width:$px !important",".mw":"min-width:$px",".wp":"width:$%",".wpi":"width:$% !important",".h":"height:$px",".hi":"height:$px !important",".mh":"min-height:$px",".hp":"height:$%",".hpi":"height:$% !important",".l":"left:$px",".r":"right:$px",".t":"top:$px",".b":"bottom:$px",".lh":"line-height:$px",".fs":"font-size:$px",".fw":"font-weight:$",".bgs":"background-size:$px",".br":"border-radius:$px",".c":"color: #",".bgc":"background-color: #",".z":"z-index: $"},$="",x="",l=null;function y(t){if(!$||JSON.stringify(t)!=$){if($=JSON.stringify(t),t.mode==="rem")for(let e in s)s[e]=s[e].replace(/\$px/gi,"$rem");l={...s,...t.config||{}};let i=[];for(let e in l){let n=l[e];n.indexOf("$")!=-1?i.push(`\\${e}-[0-9]+`):n.indexOf("#")!=-1?i.push(`\\${e}-[0-9a-fA-F]+`):i.push(`\\${e}`);}return i.sort((e,n)=>n.length-e.length),x=i.join("|"),x}else return x}function b(t){let i="",e="",n="";try{i=t.match(/<template lang=("|')pug("|')>([\s\S]*)<\/template>/g),e=t.match(/<template>([\s\S]*)<\/template>/g),i?n=i[0]:e&&(n="."+(e[0].match(/class=("|')([a-zA-Z0-9 \- _]*)("|')/gi)||[]).map(r=>r.replace(/class=('|")|("|')/g,"").split(" ").join(".")).join("."));}catch(r){return console.warn(r),""}return n}function w(t,i){let e=new RegExp(t,"ig");function n(a,c,p){return p.indexOf(a)===c}let r=(i.match(e)||[]).filter(n),o=[];return r.forEach(a=>{if(l[a.split("-")[0]]&&l[a.split("-")[0]].indexOf("$")==-1&&l[a.split("-")[0]].indexOf("#")!=-1&&/^[0-9a-fA-F]+$/.test(a.split("-")[1])){let p=a.split("-");if(p.length>1){let g=p.slice(0,p.length-1).join("-"),d="#"+p[p.length-1];o.push(`${a}{${l[g].replace(/\#/g,d)}}`);}}else if(/\d+/.test(a)){let p=a.split("-");if(p.length>1){let g=p.slice(0,p.length-1).join("-"),d=p[p.length-1];o.push(`${a}{${l[g].replace(/\$/g,d)}}`);}}else {let p=a;o.push(`${a}{${l[p]}}`);}}),o}function m(t,i={}){let e=y(i),n=b(t);if(!n)return {code:t,css:[]};let r=w(e,n);return {code:`${t}
<style>${r.join("")}</style>
`,css:r}}function j(){return v__default.default.dirname(url.fileURLToPath((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (document.currentScript && document.currentScript.src || new URL('out.js', document.baseURI).href))))+"/"}var u={};function A(t,i,e){return e.indexOf(t)===i}function F(){let t=[];for(let i in u)t=t.concat(u[i]).filter(A);h__default.default.writeFileSync(j()+"atomcss-generated.css",t.join(""),"utf8");}var f=/\.(vue)$/;function C(t){return {name:"vite-plugin-vue-atomcss",enforce:"pre",apply:"serve",transform(i,e){if(f.test(e))return {code:m(i,t).code}},transformIndexHtml(i){return [{tag:"script",attrs:{type:"module",src:"/node_modules/vite-plugin-vue-atomcss/client.js"},injectTo:"body"}]},handleHotUpdate({modules:i,server:e}){let n=i.filter(r=>f.test(r.id)).map(r=>r.id);if(n.length>0){let r=h__default.default.readFileSync(n[0],"utf8"),o=m(r,t);e.ws.send({type:"custom",event:"atomcss:update-style",data:{key:n[0],value:o.css.join("")}});}}}}function O(t){return {name:"vite-plugin-vue-atomcss",enforce:"pre",apply:"build",transform(i,e){if(f.test(e)){let n=m(i,t);u[e]=n.css,F();}}}}function R(t){return [C(t),O(t)]}

module.exports = R;
